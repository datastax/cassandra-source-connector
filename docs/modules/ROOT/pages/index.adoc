= About DataStax CDC for Apache Cassandra

DataStax CDC for Apache Cassandra® is open-source software (OSS) that sends Cassandra mutations
for tables having Change Data Capture (CDC) enabled to https://www.datastax.com/products/luna-streaming[Luna Streaming] or https://pulsar.apache.org/[Apache Pulsar]®, which in turn can write the data to platforms such as Elasticsearch&reg; or Snowflake&reg;.

== Key Features

* Supports Apache Cassandra 3.11+, 4.0+, and Datastax Enterprise Server 6.8.16+
* Supports Luna Streaming 2.7.2+ and Apache Pulsar 2.8.1+
* Propagates Cassandra schema change to the built-in Pulsar schema registry
* Supports AVRO message format


== Architecture

DataStax CDC for Apache Cassandra® has two components:

* DataStax Change Agent for Apache Cassandra, which is an event producer deployed as a JVM agent on each Cassandra data node.
* Datastax Source Connector for Apache Pulsar, which is source connector deployed in your streaming platform.

The following diagram describes the general architecture.

image::cdc-for-cassandra-overview.png[]


When CDC is enabled for a given Cassandra table:

1. The change agent running on each node reads the Cassandra commitlog files and emits a message for each Cassandra mutation in a per-table events topic.
2. The source connector processes these events and fetches the mutated Cassandra row.
3. The source connector writes the row into the data topic. This ensures the most recent state of the Cassandra table is replicated into
the data topic without the need to time re-order Cassandra mutations.

The Datastax Source Connector for Apache Pulsar also updates the schema-registry to dynamically reflect the Cassandra table schema. You can then deploy various sink connectors (see https://pulsar.apache.org/docs/en/io-connectors/#sink-connector[Pulsar built-in sink connectors]) to replicate data into the backends of your choice.


=== Deployment matrix

[cols="1,1"]
|===
| Cassandra version | Luna Streaming
| Cassandra v3.x | https://github.com/datastax/cassandra-source-connector/tree/master/agent-v3-pulsar[agent-c3-luna]
| Cassandra v4.x | https://github.com/datastax/cassandra-source-connector/tree/master/agent-v4-pulsar[agent-c4-luna]
| DSE 6.8.16+ | https://github.com/datastax/cassandra-source-connector/tree/master/agent-dse4-pulsar[agent-dse4-luna]
|===

== Supported streaming platform

* Luna Streaming 2.7.2 and later
* Apache Pulsar 2.8.1 and later

[#supported-databases]
== Supported databases

* Open source Apache® Cassandra® 3.11.x and 4.x databases
* Datastax Server Enterprise 6.8.16+

== Supported Cassandra data structures

The following Cassandra CQL3 data types (with the associated AVRO type or logical-type) are supported:

* text (string), ascii (string)
* tinyint (int), smallint (int), int (int), bigint (long), double (double), float (float),
* inet (string)
* decimal (cql_decimal), varint (cql_varint), duration (cql_duration)
* blob(bytes)
* boolean (boolean)
* timestamp (timestamp-millis), time (time-micros), date (date)
* uuid, timeuuid (uuid)
* User Defined Types (record)

Cassandra static columns are supported:

* On row level updates, static columns are included in the message value.
* On partition level updates, the clustering keys are null in the message key, and the message value only has static columns on insert/update operations.

== Limitations

* Does not manage table truncates
* Does not replay logged batches
* Does not sync data available before starting the CDC producer.
* Does not manage time-to-live
* Does not support range deletes
* CQL column names must not match a Pulsar primitive type name (ex: INT32)

== Deployment Notes

=== Schema updates on topics

Schema registry updates on a Pulsar topic are controlled by the "is-allow-auto-update-schema" option.

* "True" allows the broker to register a new schema for a topic and connect the producer if the schema is not registered.
* "False" rejects the producer's connection to the broker if the schema is not registered.

To ensure the source connector can automatically update the schema on the Pulsar topic, set the option to "true". Learn more at (https://pulsar.apache.org/docs/en/schema-manage/)[Schema Auto-Update].

=== Multiple Cassandra datacenters

In a multi-datacenter Cassandra configuration, only enable CDC and install the change agent in a single datacenter. To ensure the data sent to all datacenters are delivered to the data topic, makes sure that replication to the datacenter that has CDC enabled is configured on the table. 

For example, given a Cassandra cluster with 3 datacenters, DC1, DC2, and DC3, you would only enable CDC and install the change agent in DC1. To ensure all updates in DC2 and DC2 are propagated to the data topic, configure the table to replicate data from DC2 and DC3 to DC1 (ex replication = {'class': 'NetworkTopologyStrategy', 'dc1': '3', 'dc2': '3', 'dc3': '3'}). The data replicated to DC1 will be processed by the change agent and eventually end up in the data topic.

== Where to go next

If you've got more questions...:: For additional information about DataStax CDC for Apache Cassandra, see xref::faqs.adoc[].
