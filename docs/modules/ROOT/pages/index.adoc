= About DataStax Cassandra Source Connector

DataStax Cassandra® Source Connector is open-source software (OSS) that sends Cassandra mutations
for tables having Change Data Capture (CDC) enabled to https://pulsar.apache.org/[Apache Pulsar]®, which in turn can write the data to platforms such as Elasticsearch&reg; or Snowflake&reg;.

== Key Features

* Support both Apache Cassandra 3.11+, 4.0+ and Datastax Enterprise Server 6.8.16+
* Support Luna Streaming 2.7.2
* Propagate Cassandra schema change to the Apache Pulsar schema registry
* Support AVRO message format.

== Limitations

* Does not manage table truncates
* Does not replay logged batches
* Does not sync data available before starting the CDC producer.
* Does not manage time-to-live
* Does not support range deletes

== Architecture

The DataStax Cassandra® Source Connector two components:

* An event producer deployed as a JVM agent on each Cassandra data node.
* A Cassandra source connector deployed in your streaming platform.

The following diagram describes the general architecture.

image::cassandra-source-connector.png[]

1. When CDC is enabled for a given Cassandra table, the event producer running on each nodes reads the Cassandra commitlog
files and emit a message for each Cassandra mutation in a per-table events topic. This message only includes the row primary key, a unique MD5 digest, and the originator node id.
2. Then the source connector process these events, it fetches the mutated Cassandra row through LOCAL_QUORUM read (or LOCAL_ONE if it fails),
3. and writes the row into the data topic. This ensures the most recent state of the Cassandra table is replicated into
the data topic without the need to time re-order Cassandra mutations. Of course, this does not ensure you get all the mutations,
but you get a consistent replication of the data.

In order to deduplicate mutations coming from multiple replicas, the source connector keeps a MD5 digest of the mutation in
a memory cache if the LOCAL_QUORUM read succeed from the originator node. Step 2 and 3 are then skipped if the MD5 digest
is found in the memory cache.

The Cassandra Source Connector also updates the schema-registry to dynamically reflect the Cassandra table schema. You can then deploy
various sink connectors (see https://pulsar.apache.org/docs/en/io-connectors/#sink-connector[Pulsar built-in sink connectors])
to replicate data into the backends of your choice.

To manage this option, set "is-allow-auto-update-schema" to "true" or "false".
* "True" allows the broker to register a new schema for a topic and connect the producer if the schema is not registered.
* "False" rejects the producer's connection to the broker if the schema is not registered.

Learn more at (https://pulsar.apache.org/docs/en/schema-manage/)[Schema Auto-Update].

=== Deployment matrix

[cols="1,1,1,1"]
|===
| Streaming platform | Cassandra v3.x producer | Cassandra v4.x producer  | Source connector

| Apache Pulsar
| https://github.com/datastax/cassandra-source-connector/tree/master/producer-v3-pulsar[producer-v3-pulsar]
| https://github.com/datastax/cassandra-source-connector/tree/master/producer-v4-pulsar[producer-v4-pulsar]
| https://github.com/datastax/cassandra-source-connector/tree/master/source-pulsar[source-pulsar]

|===

== Supported streaming platform

* Luna Streaming 2.7.2 and later

[#supported-databases]
== Supported databases

* Open source Apache® Cassandra® 3.11.x and 4.x databases
* Datastax Server Enterprise 6.8.16+

== Supported Cassandra data structures

Cassandra supported CQL3 data types (with the associated AVRO type or logical-type):

* text (string), ascii (string)
* tinyint (int), smallint (int), int (int), bigint (long), double (double), float (float),
* inet (string)
* decimal (cql_decimal), varint (cql_varint), duration (cql_duration)
* blob(bytes)
* boolean (boolean)
* timestamp (timestamp-millis), time (time-micros), date (date)
* uuid, timeuuid (uuid)
* User Defined Types (record)

Cassandra static columns are supported:

* On row level updates, static columns are included in the message value.
* On partition level updates, the clustering keys are null in the message key, and the message value only has static columns on insert/update operations.

== Limitations

* Does not support logged batches
* Does not manage table truncates
* Does not manage TTLs
* Does not support range deletes
* Does not sync data available before starting the CDC producer.

== Where to go next

If you've got more questions...:: For additional information about Cassandra Source Connector, see xref::faqs.adoc[].
